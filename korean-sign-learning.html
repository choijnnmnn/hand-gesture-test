<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÌïúÍ∏Ä ÏàòÌôî ÌïôÏäµ - ÏÜêÍ∞ÄÎùΩÏúºÎ°ú Ïù¥Î¶Ñ Î∞∞Ïö∞Í∏∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .left-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .right-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .video-container {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border: 3px solid #e0e0e0;
        }

        #video {
            width: 100%;
            max-width: 500px;
            height: auto;
            background: #000;
            transform: scaleX(-1);
        }

        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            transform: scaleX(-1);
        }

        .controls {
            text-align: center;
            margin: 20px 0;
        }

        button {
            background: #3498db;
            border: none;
            color: white;
            padding: 15px 30px;
            margin: 0 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            background: #bdc3c7;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .name-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
        }

        .name-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }

        .decomposed-letters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .letter-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            min-width: 60px;
            transition: all 0.3s ease;
        }

        .letter-card.current {
            background: #e3f2fd;
            border-color: #2196f3;
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        }

        .letter-card.completed {
            background: #e8f5e8;
            border-color: #4caf50;
        }

        .letter-card h4 {
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .letter-card p {
            font-size: 0.9em;
            color: #666;
        }

        .learning-section {
            margin-top: 30px;
        }

        .current-letter {
            text-align: center;
            margin: 20px 0;
        }

        .current-letter h2 {
            font-size: 3em;
            color: #e74c3c;
            margin-bottom: 10px;
        }

        .current-letter p {
            font-size: 1.2em;
            color: #666;
        }

        .sign-guide {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #e9ecef;
        }

        .sign-guide h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .sign-guide ul {
            list-style: none;
            padding: 0;
        }

        .sign-guide li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .sign-guide li:last-child {
            border-bottom: none;
        }

        .progress-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 0.3s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stat-card h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-card .number {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }

        .feedback-section {
            margin: 20px 0;
            text-align: center;
        }

        .feedback {
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            margin: 10px 0;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .feedback.practice {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .gesture-status {
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #bbdefb;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            font-style: italic;
        }

        .achievement-section {
            background: #fff3cd;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #ffeaa7;
        }

        .achievement-section h4 {
            color: #856404;
            margin-bottom: 15px;
        }

        .badges {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .badge {
            background: #ffd700;
            color: #333;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .badge.locked {
            background: #e9ecef;
            color: #6c757d;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .decomposed-letters {
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .sign-example {
            margin-top: 20px;
            text-align: center;
        }

        .sign-example h5 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .sign-image {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            color: #2c3e50;
            position: relative;
            overflow: hidden;
        }

        .sign-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .sign-image .emoji {
            font-size: 4em;
        }

        .hidden {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ö ÌïúÍ∏Ä ÏàòÌôî ÌïôÏäµ</h1>
            <p>ÏÜêÍ∞ÄÎùΩÏúºÎ°ú ÎÇòÏùò Ïù¥Î¶ÑÏùÑ Î∞∞ÏõåÎ≥¥ÏÑ∏Ïöî!</p>
        </div>

        <div class="main-content">
            <!-- ÏôºÏ™Ω Ìå®ÎÑê: Ïπ¥Î©îÎùº Î∞è Ïã§ÏãúÍ∞Ñ Ïù∏Ïãù -->
            <div class="left-panel">
                <h3>üìπ Ïã§ÏãúÍ∞Ñ ÏàòÌôî Ïù∏Ïãù</h3>
                
                <div class="video-container">
                    <video id="video" autoplay muted playsinline></video>
                    <canvas id="canvas"></canvas>
                </div>

                <div class="controls">
                    <button id="startBtn">Ïπ¥Î©îÎùº ÏãúÏûë</button>
                    <button id="stopBtn" disabled>Ïπ¥Î©îÎùº Ï§ëÏßÄ</button>
                    <button id="practiceBtn" disabled>Ïó∞Ïäµ Î™®Îìú</button>
                </div>

                <div class="feedback-section">
                    <div id="feedback" class="feedback hidden"></div>
                    <div id="gestureStatus" class="gesture-status hidden">
                        <p>ÏÜêÏùÑ Ïπ¥Î©îÎùº ÏïûÏóê Ïò¨Î†§Ï£ºÏÑ∏Ïöî</p>
                    </div>
                </div>

                <div class="current-letter">
                    <h2 id="currentLetterDisplay">-</h2>
                    <p id="currentLetterName">ÌïôÏäµÌï† ÏûêÎ™®ÏùåÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</p>
                </div>
            </div>

            <!-- Ïò§Î•∏Ï™Ω Ìå®ÎÑê: ÌïôÏäµ Í¥ÄÎ¶¨ -->
            <div class="right-panel">
                <div class="input-section">
                    <h3>‚úèÔ∏è Ïù¥Î¶Ñ ÏûÖÎ†•</h3>
                    <input type="text" id="nameInput" class="name-input" placeholder="Ïòà: ÍπÄÏ≤†Ïàò" maxlength="10">
                    <button id="analyzeBtn" disabled>Ïù¥Î¶Ñ Î∂ÑÏÑùÌïòÍ∏∞</button>
                </div>

                <div id="decomposedSection" class="hidden">
                    <h3>üî§ ÏûêÎ™®Ïùå Î∂ÑÌï¥</h3>
                    <div id="decomposedLetters" class="decomposed-letters"></div>
                </div>

                <div class="learning-section">
                    <h3>üìö ÌïôÏäµ ÏßÑÌñâ</h3>
                    
                    <div class="progress-section">
                        <h4>Ï†ÑÏ≤¥ ÏßÑÌñâÎ•†</h4>
                        <div class="progress-bar">
                            <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <p id="progressText">0% ÏôÑÎ£å</p>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <h4>ÌïôÏäµÌïú ÏûêÎ™®Ïùå</h4>
                            <div class="number" id="learnedCount">0</div>
                        </div>
                        <div class="stat-card">
                            <h4>Ï†ïÌôïÎèÑ</h4>
                            <div class="number" id="accuracy">0%</div>
                        </div>
                        <div class="stat-card">
                            <h4>Ïó∞Ïäµ ÌöüÏàò</h4>
                            <div class="number" id="practiceCount">0</div>
                        </div>
                        <div class="stat-card">
                            <h4>Ï†êÏàò</h4>
                            <div class="number" id="score">0</div>
                        </div>
                    </div>

                <div class="sign-guide">
                    <h4>üéØ ÌòÑÏû¨ ÏûêÎ™®Ïùå ÏàòÌôî Î∞©Î≤ï</h4>
                    <div id="signInstructions">
                        Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÍ≥† Î∂ÑÏÑùÌïòÍ∏∞ Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî.
                    </div>
                    <div id="signExample" class="sign-example hidden">
                        <h5>ÏàòÌôî ÏòàÏãú</h5>
                        <div id="signImage" class="sign-image"></div>
                    </div>
                </div>

                    <div class="achievement-section">
                        <h4>üèÜ ÏÑ±Ï∑® Î∞∞ÏßÄ</h4>
                        <div id="badges" class="badges">
                            <div class="badge locked">Ï≤´ ÏàòÌôî</div>
                            <div class="badge locked">ÏûêÎ™®Ïùå ÎßàÏä§ÌÑ∞</div>
                            <div class="badge locked">Ïù¥Î¶Ñ ÏôÑÏÑ±</div>
                            <div class="badge locked">ÏàòÌôî Ï†ÑÎ¨∏Í∞Ä</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <script>
        class KoreanSignLanguageLearner {
            constructor() {
                this.video = document.getElementById('video');
                this.canvas = document.getElementById('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.startBtn = document.getElementById('startBtn');
                this.stopBtn = document.getElementById('stopBtn');
                this.practiceBtn = document.getElementById('practiceBtn');
                this.nameInput = document.getElementById('nameInput');
                this.analyzeBtn = document.getElementById('analyzeBtn');
                
                this.hands = null;
                this.camera = null;
                this.isRunning = false;
                this.isPracticing = false;
                
                // ÌïôÏäµ Îç∞Ïù¥ÌÑ∞
                this.userName = '';
                this.decomposedLetters = [];
                this.currentLetterIndex = 0;
                this.learnedLetters = new Set();
                this.practiceCount = 0;
                this.correctCount = 0;
                this.score = 0;
                
                // ÏÜê ÎèôÏûë Í∞êÏßÄ ÏÉÅÌÉú
                this.handDetected = false;
                this.lastHandState = false;
                this.gestureStartTime = 0;
                this.isGestureActive = false;
                
                // ÏàòÌôî Ìå®ÌÑ¥ Ï†ïÏùò
                this.signPatterns = this.initializeSignPatterns();
                
                this.initializeMediaPipe();
                this.setupEventListeners();
            }

            initializeSignPatterns() {
                return {
                    // Ï¥àÏÑ±
                    '„Ñ±': { thumb: 'extended', index: 'extended', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'ÏóÑÏßÄÏôÄ Í≤ÄÏßÄÎ•º Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Ñ¥': { thumb: 'bent', index: 'extended', middle: 'extended', ring: 'bent', pinky: 'bent', description: 'Í≤ÄÏßÄÏôÄ Ï§ëÏßÄÎ•º Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Ñ∑': { thumb: 'bent', index: 'extended', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'Í≤ÄÏßÄÎßå Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Ñπ': { thumb: 'extended', index: 'bent', middle: 'extended', ring: 'bent', pinky: 'bent', description: 'ÏóÑÏßÄÏôÄ Ï§ëÏßÄÎ•º Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„ÖÅ': { thumb: 'bent', index: 'bent', middle: 'bent', ring: 'bent', pinky: 'extended', description: 'ÏÜåÏßÄÎßå Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„ÖÇ': { thumb: 'extended', index: 'extended', middle: 'extended', ring: 'bent', pinky: 'bent', description: 'ÏóÑÏßÄ, Í≤ÄÏßÄ, Ï§ëÏßÄÎ•º Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„ÖÖ': { thumb: 'bent', index: 'bent', middle: 'bent', ring: 'extended', pinky: 'extended', description: 'ÏïΩÏßÄÏôÄ ÏÜåÏßÄÎ•º Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Öá': { thumb: 'bent', index: 'bent', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'Î™®Îì† ÏÜêÍ∞ÄÎùΩÏùÑ Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî (Ï£ºÎ®π)' },
                    '„Öà': { thumb: 'extended', index: 'extended', middle: 'bent', ring: 'bent', pinky: 'extended', description: 'ÏóÑÏßÄ, Í≤ÄÏßÄ, ÏÜåÏßÄÎ•º Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Öä': { thumb: 'extended', index: 'bent', middle: 'bent', ring: 'extended', pinky: 'extended', description: 'ÏóÑÏßÄ, ÏïΩÏßÄ, ÏÜåÏßÄÎ•º Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Öã': { thumb: 'extended', index: 'extended', middle: 'extended', ring: 'extended', pinky: 'bent', description: 'ÏÜåÏßÄÎßå Íµ¨Î∂ÄÎ¶¨Í≥† ÎÇòÎ®∏ÏßÄÎäî Ìé¥ÏÑ∏Ïöî' },
                    '„Öå': { thumb: 'bent', index: 'extended', middle: 'extended', ring: 'extended', pinky: 'bent', description: 'ÏóÑÏßÄÏôÄ ÏÜåÏßÄÎßå Íµ¨Î∂ÄÎ¶¨Í≥† ÎÇòÎ®∏ÏßÄÎäî Ìé¥ÏÑ∏Ïöî' },
                    '„Öç': { thumb: 'extended', index: 'bent', middle: 'bent', ring: 'bent', pinky: 'extended', description: 'ÏóÑÏßÄÏôÄ ÏÜåÏßÄÎßå Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Öé': { thumb: 'extended', index: 'bent', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'ÏóÑÏßÄÎßå Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    
                    // Ï§ëÏÑ±
                    '„Öè': { thumb: 'extended', index: 'extended', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'ÏóÑÏßÄÏôÄ Í≤ÄÏßÄÎ•º Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Öë': { thumb: 'extended', index: 'extended', middle: 'extended', ring: 'bent', pinky: 'bent', description: 'ÏóÑÏßÄ, Í≤ÄÏßÄ, Ï§ëÏßÄÎ•º Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Öì': { thumb: 'bent', index: 'extended', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'Í≤ÄÏßÄÎßå Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Öï': { thumb: 'bent', index: 'extended', middle: 'extended', ring: 'bent', pinky: 'bent', description: 'Í≤ÄÏßÄÏôÄ Ï§ëÏßÄÎ•º Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Öó': { thumb: 'extended', index: 'bent', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'ÏóÑÏßÄÎßå Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Öõ': { thumb: 'extended', index: 'bent', middle: 'extended', ring: 'bent', pinky: 'bent', description: 'ÏóÑÏßÄÏôÄ Ï§ëÏßÄÎßå Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Öú': { thumb: 'bent', index: 'bent', middle: 'bent', ring: 'bent', pinky: 'extended', description: 'ÏÜåÏßÄÎßå Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Ö†': { thumb: 'bent', index: 'bent', middle: 'bent', ring: 'extended', pinky: 'extended', description: 'ÏïΩÏßÄÏôÄ ÏÜåÏßÄÎ•º Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Ö°': { thumb: 'bent', index: 'bent', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'Î™®Îì† ÏÜêÍ∞ÄÎùΩÏùÑ Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî (Ï£ºÎ®π)' },
                    '„Ö£': { thumb: 'bent', index: 'extended', middle: 'extended', ring: 'extended', pinky: 'extended', description: 'ÏóÑÏßÄÎßå Íµ¨Î∂ÄÎ¶¨Í≥† ÎÇòÎ®∏ÏßÄÎäî Ìé¥ÏÑ∏Ïöî' },
                    
                    // Ï¢ÖÏÑ± (ÏùºÎ∂ÄÎßå ÏòàÏãú)
                    '„Ñ±(Ï¢Ö)': { thumb: 'extended', index: 'extended', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'ÏóÑÏßÄÏôÄ Í≤ÄÏßÄÎ•º Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Ñ¥(Ï¢Ö)': { thumb: 'bent', index: 'extended', middle: 'extended', ring: 'bent', pinky: 'bent', description: 'Í≤ÄÏßÄÏôÄ Ï§ëÏßÄÎ•º Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Ñ∑(Ï¢Ö)': { thumb: 'bent', index: 'extended', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'Í≤ÄÏßÄÎßå Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Ñπ(Ï¢Ö)': { thumb: 'extended', index: 'bent', middle: 'extended', ring: 'bent', pinky: 'bent', description: 'ÏóÑÏßÄÏôÄ Ï§ëÏßÄÎ•º Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„ÖÅ(Ï¢Ö)': { thumb: 'bent', index: 'bent', middle: 'bent', ring: 'bent', pinky: 'extended', description: 'ÏÜåÏßÄÎßå Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„ÖÇ(Ï¢Ö)': { thumb: 'extended', index: 'extended', middle: 'extended', ring: 'bent', pinky: 'bent', description: 'ÏóÑÏßÄ, Í≤ÄÏßÄ, Ï§ëÏßÄÎ•º Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„ÖÖ(Ï¢Ö)': { thumb: 'bent', index: 'bent', middle: 'bent', ring: 'extended', pinky: 'extended', description: 'ÏïΩÏßÄÏôÄ ÏÜåÏßÄÎ•º Ìé¥Í≥† ÎÇòÎ®∏ÏßÄÎäî Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî' },
                    '„Öá(Ï¢Ö)': { thumb: 'bent', index: 'bent', middle: 'bent', ring: 'bent', pinky: 'bent', description: 'Î™®Îì† ÏÜêÍ∞ÄÎùΩÏùÑ Íµ¨Î∂ÄÎ¶¨ÏÑ∏Ïöî (Ï£ºÎ®π)' }
                };
            }

            async initializeMediaPipe() {
                this.hands = new Hands({
                    locateFile: (file) => {
                        return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                    }
                });

                this.hands.setOptions({
                    maxNumHands: 1,
                    modelComplexity: 1,
                    minDetectionConfidence: 0.7,
                    minTrackingConfidence: 0.7
                });

                this.hands.onResults((results) => {
                    this.onResults(results);
                });
            }

            setupEventListeners() {
                this.startBtn.addEventListener('click', () => this.startCamera());
                this.stopBtn.addEventListener('click', () => this.stopCamera());
                this.practiceBtn.addEventListener('click', () => this.togglePracticeMode());
                this.nameInput.addEventListener('input', () => this.onNameInputChange());
                this.analyzeBtn.addEventListener('click', () => this.analyzeName());
            }

            onNameInputChange() {
                const name = this.nameInput.value.trim();
                this.analyzeBtn.disabled = !name;
            }

            analyzeName() {
                const name = this.nameInput.value.trim();
                if (!name) return;

                this.userName = name;
                this.decomposedLetters = this.decomposeKoreanName(name);
                this.currentLetterIndex = 0;
                this.learnedLetters.clear();
                this.practiceCount = 0;
                this.correctCount = 0;
                this.score = 0;

                this.displayDecomposedLetters();
                this.updateCurrentLetter();
                this.updateProgress();
                this.updateStats();

                document.getElementById('decomposedSection').classList.remove('hidden');
                this.practiceBtn.disabled = false;
            }

            decomposeKoreanName(name) {
                const letters = [];
                for (let i = 0; i < name.length; i++) {
                    const char = name[i];
                    const code = char.charCodeAt(0);
                    
                    if (code >= 0xAC00 && code <= 0xD7A3) { // ÌïúÍ∏Ä ÏôÑÏÑ±Ìòï
                        const base = code - 0xAC00;
                        const initial = Math.floor(base / 588);
                        const medial = Math.floor((base % 588) / 28);
                        const final = base % 28;
                        
                        const initials = ['„Ñ±', '„Ñ≤', '„Ñ¥', '„Ñ∑', '„Ñ∏', '„Ñπ', '„ÖÅ', '„ÖÇ', '„ÖÉ', '„ÖÖ', '„ÖÜ', '„Öá', '„Öà', '„Öâ', '„Öä', '„Öã', '„Öå', '„Öç', '„Öé'];
                        const medials = ['„Öè', '„Öê', '„Öë', '„Öí', '„Öì', '„Öî', '„Öï', '„Öñ', '„Öó', '„Öò', '„Öô', '„Öö', '„Öõ', '„Öú', '„Öù', '„Öû', '„Öü', '„Ö†', '„Ö°', '„Ö¢', '„Ö£'];
                        const finals = ['', '„Ñ±', '„Ñ≤', '„Ñ≥', '„Ñ¥', '„Ñµ', '„Ñ∂', '„Ñ∑', '„Ñπ', '„Ñ∫', '„Ñª', '„Ñº', '„ÑΩ', '„Ñæ', '„Ñø', '„ÖÄ', '„ÖÅ', '„ÖÇ', '„ÖÑ', '„ÖÖ', '„ÖÜ', '„Öá', '„Öà', '„Öä', '„Öã', '„Öå', '„Öç', '„Öé'];
                        
                        letters.push({
                            char: char,
                            initial: initials[initial],
                            medial: medials[medial],
                            final: finals[final],
                            type: 'syllable'
                        });
                    } else {
                        letters.push({
                            char: char,
                            initial: char,
                            medial: '',
                            final: '',
                            type: 'other'
                        });
                    }
                }
                return letters;
            }

            displayDecomposedLetters() {
                const container = document.getElementById('decomposedLetters');
                container.innerHTML = '';

                this.decomposedLetters.forEach((letter, index) => {
                    const card = document.createElement('div');
                    card.className = 'letter-card';
                    card.id = `letter-${index}`;
                    
                    if (letter.type === 'syllable') {
                        card.innerHTML = `
                            <h4>${letter.char}</h4>
                            <p>${letter.initial}${letter.medial}${letter.final}</p>
                        `;
                    } else {
                        card.innerHTML = `
                            <h4>${letter.char}</h4>
                            <p>Í∏∞ÌÉÄ</p>
                        `;
                    }
                    
                    container.appendChild(card);
                });
            }

            updateCurrentLetter() {
                if (this.currentLetterIndex >= this.decomposedLetters.length) {
                    document.getElementById('currentLetterDisplay').textContent = 'ÏôÑÎ£å!';
                    document.getElementById('currentLetterName').textContent = 'Î™®Îì† ÏûêÎ™®ÏùåÏùÑ ÌïôÏäµÌñàÏäµÎãàÎã§!';
                    this.showAchievement('Ïù¥Î¶Ñ ÏôÑÏÑ±');
                    return;
                }

                const currentLetter = this.decomposedLetters[this.currentLetterIndex];
                const letterCards = document.querySelectorAll('.letter-card');
                
                // Î™®Îì† Ïπ¥ÎìúÏóêÏÑú current ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
                letterCards.forEach(card => card.classList.remove('current'));
                
                // ÌòÑÏû¨ Ïπ¥ÎìúÏóê current ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
                if (letterCards[this.currentLetterIndex]) {
                    letterCards[this.currentLetterIndex].classList.add('current');
                }

                if (currentLetter.type === 'syllable') {
                    // Ï¥àÏÑ±Î∂ÄÌÑ∞ ÌïôÏäµ
                    const initial = currentLetter.initial;
                    document.getElementById('currentLetterDisplay').textContent = initial;
                    document.getElementById('currentLetterName').textContent = `Ï¥àÏÑ±: ${initial}`;
                    this.updateSignInstructions(initial);
                } else {
                    document.getElementById('currentLetterDisplay').textContent = currentLetter.char;
                    document.getElementById('currentLetterName').textContent = 'ÌäπÏàòÎ¨∏Ïûê';
                    document.getElementById('signInstructions').innerHTML = 'Ïù¥ Î¨∏ÏûêÎäî ÏàòÌôîÎ°ú ÌëúÌòÑÌï† Ïàò ÏóÜÏäµÎãàÎã§.';
                }
            }

            updateSignInstructions(letter) {
                const pattern = this.signPatterns[letter];
                if (pattern) {
                    document.getElementById('signInstructions').innerHTML = `
                        <ul>
                            <li>${pattern.description}</li>
                            <li>ÏóÑÏßÄ: ${pattern.thumb === 'extended' ? 'Ìé¥Í∏∞' : 'Íµ¨Î∂ÄÎ¶¨Í∏∞'}</li>
                            <li>Í≤ÄÏßÄ: ${pattern.index === 'extended' ? 'Ìé¥Í∏∞' : 'Íµ¨Î∂ÄÎ¶¨Í∏∞'}</li>
                            <li>Ï§ëÏßÄ: ${pattern.middle === 'extended' ? 'Ìé¥Í∏∞' : 'Íµ¨Î∂ÄÎ¶¨Í∏∞'}</li>
                            <li>ÏïΩÏßÄ: ${pattern.ring === 'extended' ? 'Ìé¥Í∏∞' : 'Íµ¨Î∂ÄÎ¶¨Í∏∞'}</li>
                            <li>ÏÜåÏßÄ: ${pattern.pinky === 'extended' ? 'Ìé¥Í∏∞' : 'Íµ¨Î∂ÄÎ¶¨Í∏∞'}</li>
                        </ul>
                    `;
                    
                    // ÏàòÌôî ÏòàÏãú ÌëúÏãú
                    this.showSignExample(letter);
                } else {
                    document.getElementById('signInstructions').innerHTML = 'Ïù¥ ÏûêÎ™®ÏùåÏùò ÏàòÌôî Î∞©Î≤ïÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.';
                    this.hideSignExample();
                }
            }

            showSignExample(letter) {
                const signExample = document.getElementById('signExample');
                const signImage = document.getElementById('signImage');
                
                // Ïã§Ï†ú ÌïúÍ∏Ä ÏàòÏñ¥ Ïù¥ÎØ∏ÏßÄ Îß§Ìïë (Ï≤®Î∂ÄÎêú Ïù¥ÎØ∏ÏßÄ Í∏∞Î∞ò)
                const signImages = {
                    // Ï¥àÏÑ± (Ï≤´ Î≤àÏß∏ Ìñâ - Ïó∞Ìïú ÌååÎûÄÏÉâ Î∞∞Í≤Ω)
                    '„Ñ±': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRTVGNUZGIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjQ4cHgiIGZpbGw9IiMzMzMiPuG4rTwvdGV4dD4KPC9zdmc+',
                    '„Ñ¥': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRTVGNUZGIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjQ4cHgiIGZpbGw9IiMzMzMiPuG4rjwvdGV4dD4KPC9zdmc+',
                    '„Ñ∑': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRTVGNUZGIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjQ4cHgiIGZpbGw9IiMzMzMiPuG4rzwvdGV4dD4KPC9zdmc+',
                    '„Ñπ': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRTVGNUZGIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjQ4cHgiIGZpbGw9IiMzMzMiPuG4sDwvdGV4dD4KPC9zdmc+',
                    '„ÖÅ': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRTVGNUZGIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjQ4cHgiIGZpbGw9IiMzMzMiPuG4sTwvdGV4dD4KPC9zdmc+',
                    '„ÖÇ': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRTVGNUZGIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjQ4cHgiIGZpbGw9IiMzMzMiPuG4sjwvdGV4dD4KPC9zdmc+',
                    '„ÖÖ': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRTVGNUZGIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjQ4cHgiIGZpbGw9IiMzMzMiPuG4szwvdGV4dD4KPC9zdmc+',
                    '„Öá': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRTVGNUZGIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjQ4cHgiIGZpbGw9IiMzMzMiPuG4tDwvdGV4dD4KPC9zdmc+',
                    
                    // Ï§ëÏÑ± (ÏÑ∏ Î≤àÏß∏ Ìñâ - Ïó∞Ìïú Ï¥àÎ°ùÏÉâ Î∞∞Í≤Ω)
                    '„Öè': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRTVGNUZGIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjQ4cHgiIGZpbGw9IiMzMzMiPuG4vTwvdGV4dD4KPC9zdmc+',
                    '„Öì': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRTVGNUZGIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjQ4cHgiIGZpbGw9IiMzMzMiPuG4vjwvdGV4dD4KPC9zdmc+',
                    '„Öó': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRTVGNUZGIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjQ4cHgiIGZpbGw9IiMzMzMiPuG4vzwvdGV4dD4KPC9zdmc+',
                    '„Öú': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRTVGNUZGIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjQ4cHgiIGZpbGw9IiMzMzMiPuG4wDwvdGV4dD4KPC9zdmc+',
                    '„Ö°': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRTVGNUZGIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjQ4cHgiIGZpbGw9IiMzMzMiPuG4wTwvdGV4dD4KPC9zdmc+',
                    '„Ö£': 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRTVGNUZGIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTIwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjQ4cHgiIGZpbGw9IiMzMzMiPuG4wjwvdGV4dD4KPC9zdmc+'
                };

                // Ïã§Ï†ú Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏûàÏúºÎ©¥ ÏÇ¨Ïö©, ÏóÜÏúºÎ©¥ Ïù¥Î™®ÏßÄ ÏÇ¨Ïö©
                if (signImages[letter]) {
                    signImage.innerHTML = `<img src="${signImages[letter]}" alt="${letter} ÏàòÌôî" />`;
                } else {
                    // Í∏∞Î≥∏ Ïù¥Î™®ÏßÄ Îß§Ìïë
                    const signEmojis = {
                        '„Ñ±': 'üëÜ', '„Ñ¥': '‚úåÔ∏è', '„Ñ∑': '‚òùÔ∏è', '„Ñπ': '‚úã', '„ÖÅ': '‚úä',
                        '„ÖÇ': 'üñêÔ∏è', '„ÖÖ': '‚úåÔ∏è', '„Öá': '‚úä', '„Öà': 'üëå', '„Öä': 'ü§ü',
                        '„Öã': 'üñêÔ∏è', '„Öå': '‚úåÔ∏è', '„Öç': 'üëç', '„Öé': 'üëç',
                        '„Öè': 'üëÜ', '„Öë': '‚úåÔ∏è', '„Öì': '‚òùÔ∏è', '„Öï': '‚úåÔ∏è',
                        '„Öó': 'üëç', '„Öõ': '‚úåÔ∏è', '„Öú': 'üëÜ', '„Ö†': '‚úåÔ∏è',
                        '„Ö°': '‚úä', '„Ö£': '‚úã'
                    };
                    const emoji = signEmojis[letter] || 'ü§ö';
                    signImage.innerHTML = `<div class="emoji">${emoji}</div>`;
                }
                
                signExample.classList.remove('hidden');
                signExample.classList.add('fade-in');
            }

            hideSignExample() {
                const signExample = document.getElementById('signExample');
                signExample.classList.add('hidden');
            }

            async startCamera() {
                try {
                    this.startBtn.disabled = true;

                    this.camera = new Camera(this.video, {
                        onFrame: async () => {
                            if (this.hands) {
                                await this.hands.send({ image: this.video });
                            }
                        },
                        width: 500,
                        height: 400
                    });

                    await this.camera.start();
                    this.isRunning = true;
                    this.startBtn.disabled = true;
                    this.stopBtn.disabled = false;
                    
                } catch (error) {
                    console.error('Ïπ¥Î©îÎùº ÏãúÏûë Ïò§Î•ò:', error);
                    this.startBtn.disabled = false;
                }
            }

            stopCamera() {
                if (this.camera) {
                    this.camera.stop();
                    this.camera = null;
                }
                
                this.isRunning = false;
                this.isPracticing = false;
                this.startBtn.disabled = false;
                this.stopBtn.disabled = true;
                this.practiceBtn.disabled = true;
                
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.hideFeedback();
            }

            togglePracticeMode() {
                this.isPracticing = !this.isPracticing;
                this.practiceBtn.textContent = this.isPracticing ? 'Ïó∞Ïäµ Ï§ëÏßÄ' : 'Ïó∞Ïäµ Î™®Îìú';
                this.practiceBtn.style.background = this.isPracticing ? '#e74c3c' : '#3498db';
            }

            onResults(results) {
                this.canvas.width = this.video.videoWidth;
                this.canvas.height = this.video.videoHeight;
                
                this.ctx.save();
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                    const landmarks = results.multiHandLandmarks[0];
                    this.drawHands(landmarks);
                    
                    // ÏÜê Í∞êÏßÄ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
                    this.handDetected = true;
                    
                    if (this.isPracticing && this.decomposedLetters.length > 0) {
                        this.detectGestureCycle(landmarks);
                    }
                } else {
                    this.handDetected = false;
                }
                
                this.ctx.restore();
            }

            drawHands(landmarks) {
                // ÏÜêÍ∞ÄÎùΩ Ïó∞Í≤∞ÏÑ† Í∑∏Î¶¨Í∏∞
                this.drawConnections(landmarks);
                
                // ÎûúÎìúÎßàÌÅ¨ Ï†ê Í∑∏Î¶¨Í∏∞
                landmarks.forEach((point, index) => {
                    const x = point.x * this.canvas.width;
                    const y = point.y * this.canvas.height;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, 4, 0, 2 * Math.PI);
                    
                    // ÌäπÏ†ï ÏÜêÍ∞ÄÎùΩ Í∞ïÏ°∞
                    if (index === 4) { // ÏóÑÏßÄ ÎÅù
                        this.ctx.fillStyle = '#e74c3c';
                    } else if (index === 8) { // Í≤ÄÏßÄ ÎÅù
                        this.ctx.fillStyle = '#f39c12';
                    } else if (index === 12) { // Ï§ëÏßÄ ÎÅù
                        this.ctx.fillStyle = '#27ae60';
                    } else if (index === 16) { // ÏïΩÏßÄ ÎÅù
                        this.ctx.fillStyle = '#3498db';
                    } else if (index === 20) { // ÏÜåÏßÄ ÎÅù
                        this.ctx.fillStyle = '#9b59b6';
                    } else {
                        this.ctx.fillStyle = '#34495e';
                    }
                    
                    this.ctx.fill();
                });
            }

            drawConnections(landmarks) {
                const connections = [
                    [0, 1], [1, 2], [2, 3], [3, 4], // ÏóÑÏßÄ
                    [0, 5], [5, 6], [6, 7], [7, 8], // Í≤ÄÏßÄ
                    [0, 9], [9, 10], [10, 11], [11, 12], // Ï§ëÏßÄ
                    [0, 13], [13, 14], [14, 15], [15, 16], // ÏïΩÏßÄ
                    [0, 17], [17, 18], [18, 19], [19, 20], // ÏÜåÏßÄ
                    [5, 9], [9, 13], [13, 17] // ÏÜêÎ∞îÎã• Ïó∞Í≤∞
                ];

                this.ctx.strokeStyle = '#2c3e50';
                this.ctx.lineWidth = 2;

                connections.forEach(([start, end]) => {
                    const startPoint = landmarks[start];
                    const endPoint = landmarks[end];
                    
                    this.ctx.beginPath();
                    this.ctx.moveTo(startPoint.x * this.canvas.width, startPoint.y * this.canvas.height);
                    this.ctx.lineTo(endPoint.x * this.canvas.width, endPoint.y * this.canvas.height);
                    this.ctx.stroke();
                });
            }

            detectGestureCycle(landmarks) {
                // ÏÜêÏù¥ ÎÇòÌÉÄÎÇ¨Îã§Í∞Ä ÏÇ¨ÎùºÏßÄÎäî Í≤ÉÏùÑ Í∞êÏßÄÌïòÏó¨ Ìïú Î≤àÏùò ÏàòÌôî ÎèôÏûëÏúºÎ°ú Ïπ¥Ïö¥Ìä∏
                const currentTime = Date.now();
                
                // ÏÜêÏù¥ ÏÉàÎ°ú Í∞êÏßÄÎêú Í≤ΩÏö∞
                if (this.handDetected && !this.lastHandState) {
                    this.gestureStartTime = currentTime;
                    this.isGestureActive = true;
                    this.updateGestureStatus('ÏÜêÏù¥ Í∞êÏßÄÎêòÏóàÏäµÎãàÎã§. ÏàòÌôîÎ•º Ïú†ÏßÄÌï¥Ï£ºÏÑ∏Ïöî...', 'detected');
                }
                
                // ÏÜêÏù¥ ÏÇ¨ÎùºÏßÑ Í≤ΩÏö∞ (Ïó∞ÏÜçÏúºÎ°ú 500ms Ïù¥ÏÉÅ ÏÜêÏù¥ Í∞êÏßÄÎêòÏßÄ ÏïäÏúºÎ©¥)
                if (!this.handDetected && this.lastHandState && this.isGestureActive) {
                    const gestureDuration = currentTime - this.gestureStartTime;
                    
                    // ÏµúÏÜå 300ms Ïù¥ÏÉÅ ÏÜêÏù¥ Í∞êÏßÄÎêòÏñ¥Ïïº Ïú†Ìö®Ìïú ÏàòÌôîÎ°ú Ïù∏Ï†ï
                    if (gestureDuration > 300) {
                        this.processGesture(landmarks);
                        this.updateGestureStatus('ÏàòÌôî ÎèôÏûëÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!', 'completed');
                    } else {
                        this.updateGestureStatus('ÏàòÌôîÎ•º Îçî Ïò§Îûò Ïú†ÏßÄÌï¥Ï£ºÏÑ∏Ïöî', 'too-short');
                    }
                    
                    this.isGestureActive = false;
                }
                
                // ÏÜêÏù¥ Í≥ÑÏÜç Í∞êÏßÄÎêòÍ≥† ÏûàÎäî Í≤ΩÏö∞
                if (this.handDetected && this.isGestureActive) {
                    const gestureDuration = currentTime - this.gestureStartTime;
                    if (gestureDuration > 1000) {
                        this.updateGestureStatus('ÏàòÌôîÎ•º Ïú†ÏßÄÌïòÍ≥† ÏûàÏäµÎãàÎã§...', 'holding');
                    }
                }
                
                // ÏÜêÏù¥ Í∞êÏßÄÎêòÏßÄ ÏïäÎäî Í≤ΩÏö∞
                if (!this.handDetected && !this.isGestureActive) {
                    this.updateGestureStatus('ÏÜêÏùÑ Ïπ¥Î©îÎùº ÏïûÏóê Ïò¨Î†§Ï£ºÏÑ∏Ïöî', 'waiting');
                }
                
                this.lastHandState = this.handDetected;
            }

            updateGestureStatus(message, type) {
                const gestureStatus = document.getElementById('gestureStatus');
                gestureStatus.textContent = message;
                gestureStatus.className = `gesture-status ${type}`;
                gestureStatus.classList.remove('hidden');
            }

            processGesture(landmarks) {
                if (this.currentLetterIndex >= this.decomposedLetters.length) return;

                const currentLetter = this.decomposedLetters[this.currentLetterIndex];
                if (currentLetter.type !== 'syllable') return;

                const targetPattern = this.signPatterns[currentLetter.initial];
                if (!targetPattern) return;

                const currentPattern = this.analyzeHandPattern(landmarks);
                const accuracy = this.calculateAccuracy(targetPattern, currentPattern);

                this.practiceCount++; // Ìïú Î≤àÏùò ÏàòÌôî ÎèôÏûëÏúºÎ°ú Ïπ¥Ïö¥Ìä∏

                if (accuracy > 0.8) {
                    this.showFeedback('Ï†ïÌôïÌï©ÎãàÎã§! üëç', 'correct');
                    this.learnedLetters.add(currentLetter.initial);
                    this.correctCount++;
                    this.score += 10;
                    
                    setTimeout(() => {
                        this.nextLetter();
                    }, 1500);
                } else if (accuracy > 0.6) {
                    this.showFeedback('Í±∞Ïùò ÎßûÏäµÎãàÎã§! Ï°∞Í∏à Îçî Ïó∞ÏäµÌï¥Î≥¥ÏÑ∏Ïöî', 'practice');
                } else {
                    this.showFeedback('Îã§Ïãú ÏãúÎèÑÌï¥Î≥¥ÏÑ∏Ïöî', 'incorrect');
                }

                this.updateStats();
            }

            analyzeHandPattern(landmarks) {
                // ÏÜêÍ∞ÄÎùΩ ÎÅùÏ†êÎì§Ïùò Í∞ÅÎèÑÏôÄ ÏúÑÏπòÎ•º Î∂ÑÏÑù
                const thumb = landmarks[4];
                const index = landmarks[8];
                const middle = landmarks[12];
                const ring = landmarks[16];
                const pinky = landmarks[20];
                const wrist = landmarks[0];

                return {
                    thumb: this.getFingerState(thumb, wrist),
                    index: this.getFingerState(index, wrist),
                    middle: this.getFingerState(middle, wrist),
                    ring: this.getFingerState(ring, wrist),
                    pinky: this.getFingerState(pinky, wrist)
                };
            }

            getFingerState(fingerTip, wrist) {
                const distance = Math.sqrt(
                    Math.pow(fingerTip.x - wrist.x, 2) + 
                    Math.pow(fingerTip.y - wrist.y, 2)
                );
                
                // Í±∞Î¶¨ Í∏∞Î∞òÏúºÎ°ú ÌéºÏ≥êÏßÑ ÏÉÅÌÉú ÌåêÎã® (ÏûÑÍ≥ÑÍ∞í Ï°∞Ï†ï ÌïÑÏöî)
                return distance > 0.15 ? 'extended' : 'bent';
            }

            calculateAccuracy(targetPattern, currentPattern) {
                let matches = 0;
                let total = 0;

                for (const finger in targetPattern) {
                    if (finger === 'description') continue;
                    total++;
                    if (targetPattern[finger] === currentPattern[finger]) {
                        matches++;
                    }
                }

                return matches / total;
            }

            showFeedback(message, type) {
                const feedback = document.getElementById('feedback');
                feedback.textContent = message;
                feedback.className = `feedback ${type}`;
                feedback.classList.remove('hidden');
                feedback.classList.add('fade-in');

                setTimeout(() => {
                    feedback.classList.remove('fade-in');
                }, 500);
            }

            hideFeedback() {
                document.getElementById('feedback').classList.add('hidden');
            }

            nextLetter() {
                this.currentLetterIndex++;
                this.updateCurrentLetter();
                this.updateProgress();
                this.hideFeedback();
            }

            updateProgress() {
                const progress = (this.currentLetterIndex / this.decomposedLetters.length) * 100;
                document.getElementById('progressFill').style.width = `${progress}%`;
                document.getElementById('progressText').textContent = `${Math.round(progress)}% ÏôÑÎ£å`;
            }

            updateStats() {
                document.getElementById('learnedCount').textContent = this.learnedLetters.size;
                
                const accuracy = this.practiceCount > 0 ? (this.correctCount / this.practiceCount) * 100 : 0;
                document.getElementById('accuracy').textContent = `${Math.round(accuracy)}%`;
                
                document.getElementById('practiceCount').textContent = this.practiceCount;
                document.getElementById('score').textContent = this.score;

                // ÏÑ±Ï∑® Î∞∞ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
                this.updateBadges();
            }

            updateBadges() {
                const badges = document.querySelectorAll('.badge');
                
                if (this.practiceCount > 0) {
                    badges[0].classList.remove('locked');
                }
                
                if (this.learnedLetters.size >= 5) {
                    badges[1].classList.remove('locked');
                }
                
                if (this.currentLetterIndex >= this.decomposedLetters.length) {
                    badges[2].classList.remove('locked');
                }
                
                if (this.score >= 100) {
                    badges[3].classList.remove('locked');
                }
            }

            showAchievement(badgeName) {
                this.showFeedback(`üèÜ ${badgeName} Î∞∞ÏßÄÎ•º ÌöçÎìùÌñàÏäµÎãàÎã§!`, 'correct');
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', () => {
            new KoreanSignLanguageLearner();
        });
    </script>
</body>
</html>
